{"version":3,"file":"corePackages/geoview-basemap-panel.js","mappings":"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","sources":["webpack://geoview-core/../geoview-basemap-panel/src/basemap-panel.tsx","webpack://geoview-core/../geoview-basemap-panel/src/index.tsx"],"sourcesContent":["import { TypeBasemapProps, TypeBasemapOptions, TypeJsonObject, TypeSelectChangeEvent, TypeWindow, TypeMapView } from 'geoview-core';\nimport { mapViewProjectionPayload } from 'geoview-core/src/api/events/payloads/map-view-projection-payload';\n\nconst w = window as TypeWindow;\n\ninterface BaseMapPanelProps {\n  mapId: string;\n  config: TypeJsonObject;\n}\n\nexport function BasemapPanel(props: BaseMapPanelProps): JSX.Element {\n  const { mapId, config } = props;\n\n  const { cgpv } = w;\n\n  const { api, react, ui } = cgpv;\n  const { Select } = ui.elements;\n\n  const { useState, useEffect } = react;\n\n  const useStyles = ui.makeStyles(() => ({\n    listContainer: {\n      marginTop: '10px',\n      height: '95%',\n    },\n    card: {\n      boxShadow: '0 4px 8px 0 rgba(0, 0, 0, 0.2)',\n      transition: '0.3s',\n      borderRadius: '5px',\n      '&:hover': {\n        boxShadow: '0 8px 16px 0 rgba(0, 0, 0, 0.2)',\n      },\n      marginBottom: 10,\n      height: '250px',\n      width: '100%',\n      display: 'block',\n      position: 'relative',\n    },\n    thumbnail: {\n      borderRadius: '5px',\n      position: 'absolute',\n      height: '100%',\n      width: '100%',\n      opacity: 0.8,\n    },\n    container: {\n      background: 'rgba(0,0,0,.68)',\n      color: '#fff',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      height: '40px',\n      display: 'flex',\n      alignItems: 'center',\n      padding: '0 5px',\n      boxSizing: 'border-box',\n      position: 'absolute',\n      left: 0,\n      bottom: 0,\n      width: 'inherit',\n    },\n  }));\n\n  const [basemapList, setBasemapList] = useState<TypeBasemapProps[]>([]);\n  const [canSwichProjection] = useState(config.canSwichProjection);\n\n  const classes = useStyles();\n\n  const projections: number[] = (config.supportedProjection as number[]) || [];\n  const [mapProjection, setMapProjection] = useState(cgpv.api.map(mapId).mapProps.map.projection);\n\n  /**\n   * Update the basemap with the layers on the map\n   *\n   * @param {string} id update the basemap on the map\n   */\n  const setBasemap = (id: string) => {\n    api.map(mapId).basemap.setBasemap(id);\n  };\n\n  /**\n   * Add basemaps from configuration\n   */\n  const addBasemaps = async () => {\n    // reset the basemaps array\n    api.map(mapId).basemap.basemaps = [];\n\n    // create the custom config basemap\n    for (let basemapIndex = 0; basemapIndex < config.customBasemaps.length; basemapIndex++) {\n      const customBasemap = config.customBasemaps[basemapIndex] as TypeJsonObject;\n      const basemap = api.map(mapId).basemap.createCustomBasemap(customBasemap as unknown as TypeBasemapProps);\n      if (basemap) setBasemapList((prevArray) => [...prevArray, basemap]);\n\n      // custom basemap are provided set it by default (can't be set as basemap from geoview config)\n      if (basemap && basemapIndex === 0) setBasemap(basemap.id!);\n    }\n\n    // create the core basemap\n    for (let basemapIndex = 0; basemapIndex < config.coreBasemaps.length; basemapIndex++) {\n      const basemapOptions = config.coreBasemaps[basemapIndex] as TypeJsonObject;\n      // eslint-disable-next-line no-await-in-loop\n      const basemap = await api.map(mapId).basemap.createCoreBasemap(basemapOptions as unknown as TypeBasemapOptions);\n      if (basemap) setBasemapList((prevArray) => [...prevArray, basemap]);\n    }\n  };\n\n  /**\n   * Set layerType from form input\n   *\n   * @param {TypeSelectChangeEvent} event TextField event\n   */\n  const setSelectedProjection = (event: TypeSelectChangeEvent<unknown>) => {\n    setMapProjection(event.target.value as number);\n    api.event.emit(mapViewProjectionPayload(api.eventNames.MAP.EVENT_MAP_VIEW_PROJECTION_CHANGE, mapId, event.target.value as number));\n\n    // get view status\n    const currentView = api.map(mapId).getView();\n    const currentCenter = currentView.getCenter();\n    const currentProjection = currentView.getProjection().getCode();\n\n    // calculate points resolution and new center (from lat long)\n    const currentPointResolution = api.projection.getResolution(currentProjection, currentCenter as number[]);\n    const newCenter = api.projection.transformPoints(currentCenter, currentProjection, 'EPSG:4326')[0];\n    const newProjection = `EPSG:${event.target.value as number}`;\n    const newPointResolution = api.projection.getResolution(newProjection, newCenter as number[]);\n    const newResolution = (currentView.getResolution() || 0 * currentPointResolution) / newPointResolution;\n\n    const newView: TypeMapView = {\n      zoom: currentView.getZoom() as number,\n      minZoom: currentView.getMinZoom(),\n      maxZoom: currentView.getMaxZoom(),\n      center: newCenter as number[],\n      projection: newProjection as string,\n      resolution: newResolution,\n    };\n\n    api.map(mapId).setView(newView);\n  };\n\n  /**\n   * load existing basemaps and create new basemaps\n   */\n  useEffect(() => {\n    addBasemaps();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div>\n      {canSwichProjection && (\n        <Select\n          fullWidth\n          labelId=\"projection-label\"\n          value={mapProjection}\n          onChange={setSelectedProjection}\n          label=\"Projection\"\n          style={{\n            display: config.canSwichProjection ? 'flex' : 'none',\n          }}\n          inputLabel={{\n            id: 'projection-label',\n          }}\n          menuItems={projections.map((value: number) => ({\n            key: value,\n            item: {\n              value,\n              children: `EPSG:${value}`,\n            },\n          }))}\n        />\n      )}\n      <div className={classes.listContainer}>\n        {basemapList.map((basemap: TypeBasemapProps) => {\n          return (\n            <div\n              role=\"button\"\n              tabIndex={0}\n              className={classes.card}\n              onClick={() => setBasemap(basemap.id as string)}\n              onKeyPress={() => setBasemap(basemap.id as string)}\n              key={basemap.id}\n            >\n              {typeof basemap.thumbnailUrl === 'string' && (\n                <img src={basemap.thumbnailUrl} alt={basemap.altText} className={classes.thumbnail} />\n              )}\n              {Array.isArray(basemap.thumbnailUrl) &&\n                basemap.thumbnailUrl.map((thumbnail, index) => {\n                  // eslint-disable-next-line react/no-array-index-key\n                  return <img key={index} src={thumbnail} alt={basemap.altText} className={classes.thumbnail} />;\n                })}\n              <div className={classes.container}>{basemap.name}</div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","import {\n  Cast,\n  AbstractPluginClass,\n  TypePluginOptions,\n  TypeIconButtonProps,\n  TypeButtonPanel,\n  TypeWindow,\n  toJsonObject,\n  TypePanelProps,\n  TypeSchemaObject,\n  TypeJsonObject,\n} from 'geoview-core';\n\nimport { BasemapPanel } from './basemap-panel';\nimport schema from '../schema.json';\nimport defaultConfig from '../default-config-basemap-panel.json';\n\nconst w = window as TypeWindow;\n\n/**\n * Create a class for the plugin instance\n */\nclass BasemapPanelPlugin extends AbstractPluginClass {\n  // store the created button panel object\n  buttonPanel: TypeButtonPanel | null;\n\n  constructor(id: string, props: TypePluginOptions) {\n    super(id, props);\n    this.buttonPanel = null;\n  }\n\n  /**\n   * Return the package schema\n   *\n   * @returns {TypeSchemaObject} the package schema\n   */\n  schema = (): TypeSchemaObject => schema;\n\n  /**\n   * Return the default config for this package\n   *\n   * @returns {TypeJsonObject} the default config\n   */\n  defaultConfig = (): TypeJsonObject => toJsonObject(defaultConfig);\n\n  /**\n   * translations object to inject to the viewer translations\n   */\n  translations = toJsonObject({\n    'en-CA': {\n      basemapPanel: 'Basemaps',\n    },\n    'fr-CA': {\n      basemapPanel: 'Fond de carte',\n    },\n  });\n\n  /**\n   * Added function called after the plugin has been initialized\n   */\n  added = (): void => {\n    const { configObj, pluginProps } = this;\n\n    const { mapId } = pluginProps;\n\n    // access the cgpv object from the window object\n    const { cgpv } = w;\n\n    if (cgpv) {\n      // access the api calls\n      const { api, ui } = cgpv;\n      const { MapIcon } = ui.elements;\n      const { language } = api.map(mapId);\n      // button props\n      const button: TypeIconButtonProps = {\n        id: 'basemapPanelButton',\n        tooltip: this.translations[language].basemapPanel as string,\n        tooltipPlacement: 'right',\n        children: <MapIcon />,\n        visible: true,\n      };\n\n      // panel props\n      const panel: TypePanelProps = {\n        title: this.translations[language].basemapPanel,\n        icon: '<i class=\"material-icons\">map</i>',\n        width: 200,\n        status: configObj?.isOpen as boolean,\n      };\n\n      // create a new button panel on the appbar\n      this.buttonPanel = api.map(mapId).appBarButtons.createAppbarPanel(button, panel, null);\n\n      // set panel content\n      this.buttonPanel?.panel?.changeContent(<BasemapPanel mapId={mapId} config={configObj || {}} />);\n    }\n  };\n\n  /**\n   * Function called when the plugin is removed, used for clean up\n   */\n  removed(): void {\n    const { mapId } = this.pluginProps;\n\n    // access the cgpv object from the window object\n    const { cgpv } = w;\n\n    if (cgpv) {\n      // access the api calls\n      const { api } = cgpv;\n\n      if (this.buttonPanel) {\n        api.map(mapId).appBarButtons.removeAppbarPanel(this.buttonPanel.id);\n\n        // reset basemaps array\n        api.map(mapId).basemap.basemaps = [];\n        // reload default basemap\n        api.map(mapId).basemap.loadDefaultBasemaps();\n      }\n    }\n  }\n}\n\nexport default BasemapPanelPlugin;\n\nw.plugins = w.plugins || {};\nw.plugins['basemap-panel'] = Cast<AbstractPluginClass>(BasemapPanelPlugin);\n"],"names":["w","window","BasemapPanel","props","mapId","config","cgpv","api","react","ui","Select","elements","useState","useEffect","useStyles","makeStyles","listContainer","marginTop","height","card","boxShadow","transition","borderRadius","marginBottom","width","display","position","thumbnail","opacity","container","background","color","overflow","textOverflow","alignItems","padding","boxSizing","left","bottom","basemapList","setBasemapList","canSwichProjection","classes","projections","supportedProjection","map","mapProps","projection","mapProjection","setMapProjection","setBasemap","id","basemap","addBasemaps","basemaps","basemapIndex","customBasemap","customBasemaps","createCustomBasemap","prevArray","length","basemapOptions","coreBasemaps","createCoreBasemap","fullWidth","labelId","value","onChange","event","target","emit","mapViewProjectionPayload","eventNames","MAP","EVENT_MAP_VIEW_PROJECTION_CHANGE","currentView","getView","currentCenter","getCenter","currentProjection","getProjection","getCode","currentPointResolution","getResolution","newCenter","transformPoints","newProjection","newPointResolution","newResolution","newView","zoom","getZoom","minZoom","getMinZoom","maxZoom","getMaxZoom","center","resolution","setView","label","style","inputLabel","menuItems","key","item","children","className","role","tabIndex","onClick","onKeyPress","thumbnailUrl","src","alt","altText","Array","isArray","index","name","BasemapPanelPlugin","schema","toJsonObject","defaultConfig","basemapPanel","configObj","pluginProps","MapIcon","language","button","tooltip","translations","tooltipPlacement","visible","panel","title","icon","status","isOpen","buttonPanel","appBarButtons","createAppbarPanel","changeContent","this","removeAppbarPanel","loadDefaultBasemaps","AbstractPluginClass","plugins","Cast"],"sourceRoot":""}